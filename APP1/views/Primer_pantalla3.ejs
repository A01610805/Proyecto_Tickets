<%- include('includes/head.ejs') %>
    <!DOCTYPE html>
    <html>
    <!-- https://zebrands.mx/wp-content/uploads/2021/07/zebrands.jpg -->

<head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body>

    <style type="text/css">

        #hola::-webkit-scrollbar {
            display: none;
        }

    #global {
        height: 1000px;
        border: 1px solid #ddd;
        background: grey;
        border-radius: 5%;
        overflow-y: scroll;
        flex-wrap: wrap;
    }            

    #global1 {
        height: 500px;
        border: 1px solid #ddd;
        background: grey;
        border-radius: 5%;
        overflow-y: scroll;
        flex-wrap: wrap;
    }

    #global::-webkit-scrollbar {
        display: none;
    }

    #global1::-webkit-scrollbar {
        display: none;
    }

    .modal-footer::-webkit-scrollbar {
        display: none;
    }

    #carrusel {
    background-color: #ddd;
    }

    #carta {
        border-radius: 5%;
    }

    #tamanio {
        font-size: xx-large;
        background-color: grey;
        font-family: 'Courier New', Courier, monospace;
    }

    .nav-wrapper {
        background-color: #757575;
    }

    #nsb::-webkit-scrollbar {
        display: none;
    }
            
            #nsb {
                height: 100px;
                border: 1px solid #ddd;
                background: white;
                border-radius: 5%;
                overflow-y: scroll;
                flex-wrap: wrap;
            }

    </style>

    <div class="row">
        <p></p>
        <nav>
            <div class="nav-wrapper">
                <div class="center">
                    <a id="logo" id="tamanio" href="/generar_ticket/enviar_ticket" class="center waves-effect waves-green btn-flat"><h5 id="logo" class="white-text">Registrar ticket</h5></a>
                </div>
            </div>
        </nav>
        <p></p>
        <div class="col s12">
            <div id="global1">
                <blockquote>
                    <div class="center">
                        <h5 id="logo" class="white-text">Mis Tickets</h5>
                    </div>
                </blockquote>
                <div class=" center">
                    <ul class="collection">
                        <% var z = 0; %>
                        <% var acumodal2 = 0 %>
                        <% var acumodal3 = 0 %>
                        <% var j = 0; %>
                        <%var y = 0%>

                        <% var i = 0; %>
                        <% var acumodal1 = 0 %>
                            <% var j = 0; %>
                                <%var y = 0%>
                                    <%var iconop = ''%>
                        <% for (let ticket of ticketsss) { %>
                            <%var color ='grey lighten-2'; 
                                var estado = '';
                    if (ticket.ID_estado == 1){
                    if(ticket.ID_estado == 1){ 
                        color = 'grey lighten-2';
                        estado = '1 - Nuevo'; 
                    } else if(ticket.ID_estado == 2){ 
                        color = 'light-blue lighten-5'; 
                        estado = '2 - En curso';
                    } else if(ticket.ID_estado == 3){ 
                        color = 'orange lighten-3'; 
                        estado = '3 - En espera de InformaciÃ³n';
                    } else if(ticket.ID_estado == 4){ 
                        color = 'yellow light-blue lighten-5'; 
                        estado = '4 - En espera de Visto Bueno';
                    } else if(ticket.ID_estado == 5){ 
                        color = 'red lighten-4'; 
                        estado = '5 - Cancelado';
                    } else if(ticket.ID_estado == 6){ 
                        color = 'light-green accent-1'; 
                        estado = '6 - Resuelto';} 
                    var prioridad = '';
                    var color_prioridad = ''
                    if(ticket.ID_prioridad == 1){
                        prioridad = 'Por Asignar'
                        color_prioridad = 'grey lighten-1'
                        iconop = 'looks_one'
                    }
                    if(ticket.ID_prioridad == 2){
                        prioridad = 'Baja'
                        color_prioridad ='teal lighten-3'
                        iconop = 'looks_two'
                    }
                    if(ticket.ID_prioridad == 3){
                        prioridad = 'Media'
                        color_prioridad ='yellow accent-1'
                        iconop = 'looks_3'
                    }
                    if(ticket.ID_prioridad == 4){
                        prioridad = 'Alta'
                        color_prioridad ='orange lighten-2'
                        iconop = 'looks_4'
                    }
                    if(ticket.ID_prioridad == 5){
                        prioridad = 'Urgente'
                        color_prioridad ='red lighten-1'
                        iconop = 'looks_5'
                    } 
                    
                    %>
                                <!-- <li class="collection-item grey darken-2"> -->
                                <div class="col s12 ">
                                    <!-- <p class="z-depth-4"> -->
                                    <div id="carta" class="card">
                                        <div class="card-content <%=color%>">
                                            <p id="titulo">
                                                <b id="logo"><%= ticket.ID_ticket + ": " + ticket.titulo %></b>
                                                <i class="material-icons left"><%= iconop %></i>
                                                <a class="waves-effect waves-light  btn-small grey modal-trigger right" href="#modala<%= acumodal1%>"><i class="material-icons">edit</i></a>
                                            </p>
                                        </div>
                                        <div id="modala<%= acumodal1%>" class="modal">
                                            <div class="modal-content">

                                                <ul class="collection">
                                                    <li class="collection-item avatar">
                                                        <i class="material-icons circle green">folder</i>
                                                        <span id="logo" class="title">
                                                                Titulo
                                                            </span>
                                                        <h5>
                                                            <%= ticket.titulo %>
                                                        </h5>
                                                        <a href="#!" class="secondary-content">
                                                            <form action="/home" method="POST">
                                                                <input type="hidden" name="_csrf" value="<%= csrfToken %>" >
                                                                <input for="idticket" id="idticket" name="idticket" type="hidden" value="<%=ticket.ID_ticket%>" />
                                                                <button id="logo" class="btn tooltipped modal-close waves-effect waves-red btn-flat btn-small" data-position="bottom" data-tooltip="Eliminar Ticket" type="submit" name="action"><i class="material-icons">delete</i>
                                                                </button>
                                                            </form>
                                                        </a>

                                                    </li>
                                                    <li class="collection-item avatar">
                                                        <i class="material-icons circle blue">collections_bookmark</i>
                                                        <span id="logo" class="title">Descripcion:</span><br>
                                                        <h5>
                                                            <%= ticket.descripcion %>
                                                        </h5>
                                                        <!-- <a href="#!" class="secondary-content">
                                                                        <form action="/home" method="POST">
                                                                            <input for="idticket" id="idticket" name="idticket" type="hidden" value="<%=ticket.ID_ticket%>" />
                                                                            <button class="btn tooltipped modal-close waves-effect waves-green btn-flat" data-position="bottom" data-tooltip="Ticket Resuelto" type="submit" name="action"><i class="material-icons">check</i>
                                                                    </button>
                                                                        </form>

                                                                    </a> -->
                                                    </li>
                                                    <li class="collection-item avatar">
                                                        <i class="material-icons circle <%= color_prioridad %>">priority_high</i>
                                                        <span id="logo" class="title">Prioridad:</span>
                                                        <h5>
                                                            <%= prioridad %> <br>
                                                        </h5>

                                                        <a href="/asignar_prioridad/get_tic/<%= ticket.ID_ticket %>" class="secondary-content modal-close"><i class="material-icons">create</i></a>
                                                    </li>

                                                    <li class="collection-item avatar">
                                                        <i class="material-icons circle <%= color %>">priority_high</i>
                                                        <span class="title">Estado:</span>
                                                        <h5>
                                                            <%= estado %> <br>
                                                        </h5>
                                                        <a href="/asignar_estado/get_ticket/<%= ticket.ID_ticket %>" class="secondary-content modal-close"><i class="material-icons">create</i></a>
                                                    </li>

                                                    <li class="collection-item avatar">
                                                        <i class="material-icons circle red">account_box</i>
                                                        <span id="logo" class="title">Asignar A:</span>
                                                        <h5>
                                                            Creador:
                                                            <%=ticket.nombre %>
                                                                <%=ticket.apellido_paterno%>
                                                                    <%=ticket.Apellido_materno%>
                                                        </h5>


                                                        <a href="/asignar_usuario/asignar/<%= ticket.ID_ticket %>" class="secondary-content modal-close"><i class="material-icons">add</i></a>
                                                    </li>
                                                </ul>


                                                <%acumodal1=acumodal1+1%>

                                            </div>

                                        </div>
                                        <div class="card-tabs">
                                            <ul id="hola" class="tabs tabs-fixed-width">
                                                <li class="tab"><a class="active" href="#test<%= i+1%>"><i class="material-icons">assignment</i></a></li>
                                                <li class="tab "><a href="#test<%= i+2%>"><i class="material-icons">forum</i></a></li>
                                                <li class="tab"><a href="#test<%=i+3%>"><i class="material-icons">assignment_ind</i></a></li>
                                                <li class="tab "><a href="#test<%= i+4%>"><i class="material-icons">chat_bubble_outline</i></a></li>

                                            </ul>
                                        </div>
                                        <div class="card-content">
                                            <div id="test<%= i+1%>">
                                                <%= ticket.descripcion %>

                                            </div>
                                            <div id="test<%= i+2%>">
                                                <p>
                                                    <% 
                                                            let r=1;
                                                            var pr="";
                                                            var rp="";
                                                            for(let respuesta of respuestas){
                                                                if(respuesta.ID_ticket==ticket.ID_ticket){
                                                                    pr += r;
                                                                    pr += ". ";
                                                                    pr += respuesta.texto_pregunta;
                                                                    rp += respuesta.texto_respuesta;
                                                                    r=r+1; %>
                                                        <b><%= pr%></b>
                                                        <%= rp%>
                                                            <br><br>
                                                            <%pr="";rp="";  
                                                                }
                                                            
                                                            }%>

                                                </p>
                                            </div>
                                            <div id="test<%= i+3%>">
                                                <p><b>Nombre del Creador:</b>
                                                    <%=ticket.nombre%>
                                                        <%=ticket.apellido_paterno%>
                                                            <%=ticket.Apellido_materno%>
                                                </p>
                                            </div>

                                            <div id="test<%= i+4%>">
                                                <a class="waves-effect waves-light  btn-tiny black-text modal-trigger right" href="#agregarcomentario1<%=y%>"><i class="material-icons">add_circle_outline</i></a>
                                                <div id="nsb">
                                                    <% for (let comment of comentario){%>
                                                        <% if(comment.ID_ticket == ticket.ID_ticket){%>
                                                            <div class="row">

                                                                <div class="col s12">

                                                                    <b class="left"><%=comment.nombre%> <%=comment.apellido_paterno%> <%=comment.apellido_materno%> dice:</b>

                                                                </div>
                                                                <div class="col s2">
                                                            

                                                                </div>
                                                                <div class="col s10">
                                                                    <p class="left">
                                                                        <%=comment.texto_comentario%>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <%}%>
                                                                <%}%>


                                                </div>


                                                <div id="agregarcomentario1<%=y%>" class="modal">
                                                    <div class="modal-content">
                                                        <h4>
                                                            Agregar comentario?
                                                        </h4>

                                                    </div>
                                                    <%y=y+1%>
                                                        <div class="modal-footer">
                                                            <div class="center ">

                                                                <a href="/agregar_com/get_agregarcomentario/<%= ticket.ID_ticket %>" class="waves-effect waves-light btn">Aceptar</a>
                                                                <a href="/home" class="waves-effect waves-light btn">Cancelar</a>
                                                            </div>
                                                            </form>





                                                        </div>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                    <!-- </p> -->
                                </div>

                                <!-- </li> -->
                                <% i=i+4 %>
                                    <% j=j+1 %>
                                        <% } %>
                                            <% } %>

                        <% for (let ticket2 of ticketsusuario) { %>
                            <%var color =''; 
                            if (ticket2.ID_estado != 1){
                                if(ticket2.ID_estado == 1){ 
                                    color = 'grey lighten-2'; 
                                } else if(ticket2.ID_estado == 2){ 
                                    color = 'light-blue lighten-5'; 
                                } else if(ticket2.ID_estado == 3){ 
                                    color = 'orange lighten-4'; 
                                } else if(ticket2.ID_estado == 4){ 
                                    color = 'yellow light-blue lighten-4'; 
                                } else if(ticket2.ID_estado == 5){ 
                                    color = 'red lighten-3'; 
                                } else if(ticket2.ID_estado == 6){ 
                                    color = 'light-green accent-1'; 
                                } 
                                var prioridad = '';
                                var color_prioridad = ''
                                if(ticket2.ID_prioridad == 1){
                                    prioridad = 'Por Asignar'
                                    color_prioridad = 'grey lighten-1'
                                    iconop = 'looks_one'
                                }
                                if(ticket2.ID_prioridad == 2){
                                    prioridad = 'Baja'
                                    color_prioridad ='teal lighten-3'
                                    iconop = 'looks_two'
                                }
                                if(ticket2.ID_prioridad == 3){
                                    prioridad = 'Media'
                                    color_prioridad ='yellow accent-1'
                                    iconop = 'looks_3'
                                }
                                if(ticket2.ID_prioridad == 4){
                                    prioridad = 'Alta'
                                    color_prioridad ='orange lighten-2'
                                    iconop = 'looks_4'
                                }
                                if(ticket2.ID_prioridad == 5){
                                    prioridad = 'Urgente'
                                    color_prioridad ='red lighten-1'
                                    iconop = 'looks_5'
                                } %>
                                <div class="col s12">
                                    <div class="card">
                                        <div class="card-content <%=color%>">
                                            <p id="titulo">
                                                <i class="material-icons left"><%= iconop %></i>
                                                <b id="logo"><%= ticket2.ID_ticket + ": " + ticket2.titulo %></b>
                                                <a class="waves-effect waves-light  btn-small grey modal-trigger right" href="#modalb<%=acumodal2%>"><i class="material-icons">edit</i></a>
                                            </p>
                                        </div>
                                        <div id="modalb<%=acumodal2%>" class="modal">
                                            <div class="modal-content">
                                                <ul class="collection">
                                                    <li class="collection-item avatar">
                                                        <i class="material-icons circle green">folder</i>
                                                        <span class="title">
                                                            Titulo
                                                        </span>
                                                        <h5>
                                                            <%= ticket2.titulo %>
                                                        </h5>
                                                        <%if(ticket2.ID_estado != 5 && ticket2.ID_estado != 6){%>
                                                        <a href="#!" class="secondary-content">
                                                            <form action="/home" method="POST">
                                                                <input type="hidden" name="_csrf" value="<%= csrfToken %>" >
                                                                <input for="idticket" id="idticket" name="idticket" type="hidden" value="<%=ticket2.ID_ticket%>" />
                                                                <button class="btn tooltipped modal-close waves-effect waves-red btn-flat btn-small" data-position="bottom" data-tooltip="Eliminar Ticket" type="submit" name="action"><i class="material-icons">delete</i>
                                                                    </button>
                                                            </form>
                                                        </a>
                                                        <% } %>
                                                    </li>
                                                    <li class="collection-item avatar">
                                                        <i class="material-icons circle blue">collections_bookmark</i>
                                                        <span class="title">Descripcion:</span><br>
                                                        <h5>
                                                            <%= ticket2.descripcion %>
                                                        </h5>
                                                    </li>
                                                </ul>
                                            <%acumodal2=acumodal2+1%>
                                            </div>
                                        </div>
                                        <div class="card-tabs">
                                            <ul id="hola" class="tabs tabs-fixed-width">
                                                <li class="tab"><a class="active" href="#tests<%= z+1%>"><i class="material-icons">assignment</i></a></li>
                                                <li class="tab"><a href="#tests<%= z+2%>"><i class="material-icons">forum</i></a></li>
                                                <li class="tab"><a href="#tests<%= z+3%>"><i class="material-icons">assignment_ind</i></a></li>
                                                <li class="tab"><a href="#tests<%= z+4%>"><i class="material-icons">chat_bubble_outline</i></a></li>
                                            </ul>
                                        </div>
                                        <div class="card-content ">
                                            <div id="tests<%= z+1%>">
                                                <%= ticket2.descripcion %>
                                            </div>
                                            <div id="tests<%=z+2%>">
                                                <p>
                                                    <%let r=1;
                                                    var pr="";
                                                    var rp="";
                                                    for(let respuesta of respuestas){
                                                        if(respuesta.ID_ticket==ticket2.ID_ticket){
                                                            pr += r;
                                                            pr += ". ";
                                                            pr += respuesta.texto_pregunta;
                                                            rp += respuesta.texto_respuesta;
                                                            r=r+1; %>
                                                            <b><%= pr%></b>
                                                            <%= rp%>
                                                            <br><br>
                                                            <%pr="";rp="";  
                                                        }                            
                                                }%>
                                                </p>
                                            </div>
                                            <div id="tests<%= z+3%>">
                                                <p><b>Nombre del Creador:</b>
                                                    <%=ticket2.Nombre_creador%>
                                                    <%=ticket2.apellido_P_creador%>
                                                    <%=ticket2.Apellido_M_creador%>
                                                </p>
                                                <p><b>Nombre del Encargado:</b>
                                                    <%=ticket2.Nombre_encargado%>
                                                    <%=ticket2.Apellido_P_encargado%>
                                                    <%=ticket2.Apellido_M_encargado%>
                                                </p>
                                            </div>
                                            <div id="tests<%= z+4%>">
                                                <div id="nsb">
                                                    <% for (let comment of comentario){%>
                                                        <% if(comment.ID_ticket == ticket2.ID_ticket){%>
                                                            <div class="row">

                                                                <div class="col s12">

                                                                    <b class="left"><%=comment.nombre%> <%=comment.apellido_paterno%> <%=comment.apellido_materno %> dice: </b>

                                                                </div>
                                                                <div class="col s2">
                                                                    <p>
                                                                        <%=comment.fecha_comentario%>
                                                                    </p>

                                                                </div>
                                                                <div class="col s10">
                                                                    <p class="left">
                                                                        <%=comment.texto_comentario%>
                                                                    </p>
                                                                </div>
                                                            </div>
                                                            <%}%>
                                                                <%}%>


                                                </div>


                                                <div id="agregarcomentario1<%=y%>" class="modal">
                                                    <div class="modal-content">
                                                        <h4>
                                                            Agregar comentario?
                                                        </h4>

                                                    </div>
                                                    <%y=y+1%>
                                                        <div class="modal-footer">
                                                            <div class="center ">

                                                                <a href="/agregar_com/get_agregarcomentario/<%= ticket2.ID_ticket %>" class="waves-effect waves-light btn">Aceptar</a>
                                                                <a href="/home" class="waves-effect waves-light btn">Cancelar</a>
                                                            </div>
                                                            </form>

                                                        </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            <% z=z+4 %>
                            <% } %>
                        <% } %>
                    </ul>
                </div>
            </div>
            <p></p>
        </div>
    </div>
    <script type="text/javascript" src="js/materialize.min.js"></script>

<%- include('includes/footer.ejs') %>
